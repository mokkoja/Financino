<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¶–µ–ª–∏ | –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –±—é–¥–∂–µ—Ç–∞</title>
    <link rel="stylesheet" href="styles.css">
    <!-- PWA –º–µ—Ç–∞—Ç–µ–≥–∏ -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#4361ee">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–ë—é–¥–∂–µ—Ç">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
</head>
<body>
    <header>
        <div class="header-content">
            <h1>–ú–æ–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ü–µ–ª–∏</h1>
            <p class="tagline">–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –∏ –¥–æ—Å—Ç–∏–≥–∞–π—Ç–µ –∂–µ–ª–∞–µ–º–æ–≥–æ</p>
        </div>
    </header>
    <nav>
        <a href="page1.html">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="stats.html">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
        <a href="goals.html" class="active">–¶–µ–ª–∏</a>
        <a href="tips.html">–°–æ–≤–µ—Ç—ã</a>
		<a href="feedback.html">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</a>
    </nav>
    <main>
        <section class="goals-form-section">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ü–µ–ª—å</h2>
            <form id="goalForm">
                <input type="text" id="goalName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏" required>
                <input type="number" id="goalAmount" placeholder="–°—É–º–º–∞ (—Ä—É–±)" required>
                <input type="date" id="goalDate" required>
                <input type="number" id="currentAmount" placeholder="–¢–µ–∫—É—â–∞—è —Å—É–º–º–∞ (—Ä—É–±)">
                <button type="submit">–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å</button>
            </form>
            <button id="resetGoals" class="reset-btn">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Ü–µ–ª–∏</button>
        </section>

        <section class="goals-list-section">
            <h2>–ú–æ–∏ —Ü–µ–ª–∏</h2>
            <div id="goalsContainer">
            </div>
        </section>
    </main>
    <footer>
        <p>¬© 2025 –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –±—é–¥–∂–µ—Ç–∞/ –ö–æ–Ω—Ç–∞–∫—Ç—ã 8(800)555-55-55</p>
    </footer>

    <script>
        function getSavedGoals() {
            const savedGoals = localStorage.getItem('financialGoals');
            return savedGoals ? JSON.parse(savedGoals) : [];
        }

        function saveGoals(goals) {
            localStorage.setItem('financialGoals', JSON.stringify(goals));
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}.${month}.${year}`;
        }

        function calculateProgress(current, target) {
            return Math.min(Math.round((current / target) * 100), 100);
        }

        function renderGoals() {
            const goals = getSavedGoals();
            const container = document.getElementById('goalsContainer');
            container.innerHTML = '';

            if (goals.length === 0) {
                container.innerHTML = '<p class="no-goals">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ü–µ–ª–µ–π. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</p>';
                return;
            }

            goals.forEach((goal, index) => {
                const progress = calculateProgress(goal.currentAmount || 0, goal.amount);
                const goalElement = document.createElement('div');
                goalElement.className = 'goal-card';
                goalElement.innerHTML = `
                    <div class="goal-header">
                        <h3>${goal.name}</h3>
                        <div class="goal-actions">
                            <button class="edit-btn" data-id="${index}">‚úèÔ∏è</button>
                            <button class="delete-btn" data-id="${index}">üóëÔ∏è</button>
                        </div>
                    </div>
                    <p>–¶–µ–ª—å: <span class="amount">${goal.amount.toLocaleString()} ‚ÇΩ</span></p>
                    <p>–ù–∞–∫–æ–ø–ª–µ–Ω–æ: <span class="current-amount">${(goal.currentAmount || 0).toLocaleString()} ‚ÇΩ</span></p>
                    <p>–°—Ä–æ–∫: <span class="date">${goal.date}</span></p>
                    <div class="progress-container">
                        <div class="progress-bar" style="width: ${progress}%">
                            <span class="progress-text">${progress}%</span>
                        </div>
                    </div>
                    <div class="add-funds">
                        <input type="number" class="add-amount" placeholder="–î–æ–±–∞–≤–∏—Ç—å —Å—É–º–º—É">
                        <button class="add-btn" data-id="${index}">+</button>
                    </div>
                `;
                container.appendChild(goalElement);
            });

            addEventListeners();
        }

        function addEventListeners() {
            // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤
            document.querySelectorAll('.add-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-id'));
                    const input = this.previousElementSibling;
                    const amount = parseFloat(input.value);
                    
                    if (amount && amount > 0) {
                        const goals = getSavedGoals();
                        goals[index].currentAmount = (goals[index].currentAmount || 0) + amount;
                        saveGoals(goals);
                        renderGoals();
                        input.value = '';
                    }
                });
            });

            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-id'));
                    const goals = getSavedGoals();
                    goals.splice(index, 1);
                    saveGoals(goals);
                    renderGoals();
                });
            });

            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-id'));
                    const goals = getSavedGoals();
                    const goal = goals[index];
                    
                    document.getElementById('goalName').value = goal.name;
                    document.getElementById('goalAmount').value = goal.amount;
                    document.getElementById('goalDate').value = goal.rawDate;
                    document.getElementById('currentAmount').value = goal.currentAmount || 0;
                    
                    goals.splice(index, 1);
                    saveGoals(goals);
                    renderGoals();
                });
            });
        }

        document.getElementById('goalForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('goalName').value;
            const amount = parseFloat(document.getElementById('goalAmount').value);
            const rawDate = document.getElementById('goalDate').value;
            const date = formatDate(rawDate);
            const currentAmount = parseFloat(document.getElementById('currentAmount').value) || 0;
            
            const goals = getSavedGoals();
            goals.push({
                name,
                amount,
                date,
                rawDate,
                currentAmount
            });
            
            saveGoals(goals);
            renderGoals();
            this.reset();
        });

        document.getElementById('resetGoals').addEventListener('click', function() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ü–µ–ª–∏?')) {
                localStorage.removeItem('financialGoals');
                renderGoals();
            }
        });

        renderGoals();
    </script>
	<script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(registration => {
              console.log('ServiceWorker registration successful');
            })
            .catch(err => {
              console.log('ServiceWorker registration failed: ', err);
            });
        });
      }
    </script>
</body>
</html>